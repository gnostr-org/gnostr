/// BIP-64MOD + GCC Static Resource Exporter
/// Recreates the 'tiny.tiff' 8x8 RGBA icon based on provided hexdump data.

use std::fs::File;
use std::io::{Write, Result};

pub mod gnostr_icon {
    pub const WIDTH: u32 = 8;
    pub const HEIGHT: u32 = 8;
    
    /// Exact 256-byte pixel data extracted from hexdump[cite: 19].
    /// Represents 64 pixels of RGBA color #3b4d61ff.
    pub const TINY_TIFF_RAW: [u8; 256] = [
        0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61,
        0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61,
        0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61,
        0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61,
        0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61,
        0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61,
        0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61,
        0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61,
        0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61,
        0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61,
        0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61,
        0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61,
        0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61,
        0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61,
        0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61,
        0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61, 0x4d, 0x3b, 0xff, 0x61,
    ];
}

fn main() -> Result<()> {
    let path = "tiny.tiff";
    let mut file = File::create(path)?;

    // --- Big Endian 'MM' Header [cite: 19] ---
    // 0x4D4D: Big Endian, 0x002A: Magic, 0x00000008: Offset to IFD
    file.write_all(&[0x4d, 0x4d, 0x00, 0x2a, 0x00, 0x00, 0x00, 0x08])?;

    // --- Number of IFD Entries (11) [cite: 19] ---
    file.write_all(&[0x00, 0x0b])?;

    // --- Image File Directory Entries (Big Endian) [cite: 19] ---
    file.write_all(&[0x00, 0x01, 0x03, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x08, 0x00, 0x00])?; // Width (8)
    file.write_all(&[0x01, 0x01, 0x03, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x08, 0x00, 0x00])?; // Height (8)
    file.write_all(&[0x02, 0x01, 0x03, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x92])?; // BPS Offset
    file.write_all(&[0x03, 0x01, 0x03, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x01, 0x00, 0x00])?; // Compression (None)
    file.write_all(&[0x06, 0x01, 0x03, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x02, 0x00, 0x00])?; // Photometric (RGB)
    file.write_all(&[0x11, 0x01, 0x04, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x9a])?; // StripOffsets (Data @ 154)
    file.write_all(&[0x15, 0x01, 0x03, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x04, 0x00, 0x00])?; // Samples/Pixel (4)
    file.write_all(&[0x16, 0x01, 0x03, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x08, 0x00, 0x00])?; // Rows/Strip (8)
    file.write_all(&[0x17, 0x01, 0x04, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x01, 0x00])?; // StripBytes (256)
    file.write_all(&[0x1a, 0x01, 0x05, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x8a])?; // XRes Offset
    file.write_all(&[0x52, 0x01, 0x03, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x01, 0x00, 0x00])?; // ExtraSamples (Alpha)
    
    file.write_all(&[0x00, 0x00, 0x00, 0x00])?; // End of IFD

    // --- Directory Value Data [cite: 19] ---
    file.write_all(&[0x00, 0x00, 0x00, 0x48, 0x00, 0x00, 0x00, 0x01])?; // X-Resolution (72 dpi)
    file.write_all(&[0x00, 0x08, 0x00, 0x08, 0x00, 0x08, 0x00, 0x08])?; // Bits Per Sample (8,8,8,8)

    // --- Raw Pixel Data (Offset 0x9a) [cite: 19] ---
    file.write_all(&gnostr_icon::TINY_TIFF_RAW)?;

    println!("File 'tiny.tiff' created successfully.");
    Ok(())
}
